<tal:block define="css_class css_class|field.widget.css_class;
                  name name|field.name;
                  oid oid|field.oid;
                  style style|field.widget.style|None;
                  type_name type_name|field.widget.type_name;
                  formid field.get_root().formid;
                  display_format display_format|field.widget.display_format"
    tal:omit-tag="">
  <div class="form-group">
    <div class="input-group date" id="${oid}">
      <input data-format="${display_format}"
             id="${oid}-input"
             type="text"
             name="${name}"
             value="${cstruct}" 
             tal:attributes="class string:${css_class} form-control hasDatepicker;
             style style"
             />
      <span class="input-group-addon">
        <span class="glyphicon glyphicon-calendar"></span>
      </span>
    </div>
  </div>
    <script type="text/javascript">
      deform.addCallback(
       '${oid}',
       function(oid) {
         $('#' + oid).datetimepicker(${options});
         var form = $('#${formid}');
         form.submit(function () {
           // normalize the value passed to the server, because hurr durr
           var picker = $('#' + oid).data('datetimepicker');
           var date = picker._date;
           /* var val = $('#${oid}-input').attr('value'); */
           reformatted = picker.submitFormat.formatDate(date);
           $('#${oid}-input').val(reformatted);
         });
       }
     );
    </script>
</tal:block>
